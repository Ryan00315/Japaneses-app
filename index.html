<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—¥æœ¬èªç­†è¨˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .card-flip { perspective: 1000px; }
        .card-inner { transition: transform 0.4s; transform-style: preserve-3d; cursor: pointer; }
        .card-inner.is-flipped { transform: rotateY(180deg); }
        .card-front, .card-back { backface-visibility: hidden; position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .card-back { transform: rotateY(180deg); }
        .active-filter { background-color: #4f46e5 !important; color: white !important; }
        .sticky-top { position: sticky; top: 0; z-index: 50; }
        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-10 font-sans text-slate-900">

    <div class="sticky-top bg-gray-50/90 backdrop-blur-md px-4 py-3 border-b border-gray-200">
        <div class="max-w-md mx-auto">
            <input type="text" id="searchInput" oninput="renderList()" placeholder="ğŸ” æœå°‹å–®å­—..." 
                   class="w-full p-3 rounded-2xl bg-white shadow-sm border border-gray-100 outline-none focus:ring-2 ring-indigo-400">
        </div>
    </div>

    <div class="max-w-md mx-auto p-4">
        <div id="status-bar" class="text-[10px] text-right text-green-500 mb-2 font-mono">â— System Ready</div>

        <header class="flex justify-between items-center mb-6">
            <h1 class="text-xl font-black text-indigo-600">å–®å­—æœ¬ V3.2</h1>
            <div class="flex gap-2">
                <button onclick="exportCSV()" class="text-xs bg-white border px-2 py-1.5 rounded-lg shadow-sm font-bold">åŒ¯å‡º</button>
                <button onclick="resetSystem()" class="text-xs bg-red-50 text-red-500 px-2 py-1.5 rounded-lg font-bold">é‡ç½®</button>
            </div>
        </header>

        <div id="quiz-section" class="mb-8 hidden">
            <div class="card-flip h-56 w-full relative mb-4">
                <div id="quiz-card" onclick="this.classList.toggle('is-flipped')" class="card-inner w-full h-full shadow-2xl">
                    <div class="card-front bg-indigo-600 text-white rounded-3xl flex flex-col items-center justify-center p-6 text-center">
                        <span id="quiz-q" class="text-5xl font-bold mb-4"></span>
                        <button onclick="event.stopPropagation(); speak(document.getElementById('quiz-q').innerText)" class="bg-white/20 p-4 rounded-full">ğŸ”Š</button>
                    </div>
                    <div class="card-back bg-white border-4 border-indigo-600 rounded-3xl flex flex-col items-center justify-center p-6">
                        <p id="quiz-r" class="text-indigo-500 font-bold mb-2"></p>
                        <p id="quiz-a" class="text-3xl font-black text-slate-800"></p>
                    </div>
                </div>
            </div>
            <button onclick="loadRandomWord()" class="w-full py-4 bg-white border-2 border-indigo-600 text-indigo-600 rounded-2xl font-black shadow-lg">NEXT WORD</button>
        </div>

        <section class="bg-white rounded-3xl p-5 shadow-sm border border-gray-100 mb-6">
            <div class="grid grid-cols-2 gap-3 mb-3">
                <input id="word" type="text" placeholder="å–®å­—" class="bg-gray-50 p-3 rounded-xl outline-none">
                <input id="reading" type="text" placeholder="å‡å" class="bg-gray-50 p-3 rounded-xl outline-none">
            </div>
            <input id="meaning" type="text" placeholder="æ„æ€" class="w-full bg-gray-50 p-3 rounded-xl mb-3 outline-none">
            <div class="flex gap-3">
                <select id="category" class="bg-gray-50 px-4 rounded-xl text-sm font-bold text-gray-500">
                    <option>åè©</option><option>å‹•è©</option><option>å½¢å®¹è©</option><option>å…¶ä»–</option>
                </select>
                <button onclick="addWord()" class="flex-1 bg-slate-800 text-white py-3 rounded-xl font-bold active:bg-black transition">åŠ å…¥æ¸…å–®</button>
            </div>
        </section>

        <ul id="vocab-list" class="space-y-3"></ul>
    </div>

    <script>
        // ã€Git å­˜æ”¾å€ã€‘ ä½ ä»¥å¾Œå¯ä»¥ç›´æ¥æŠŠå–®å­—æ‰“åœ¨é€™è£¡ï¼Œpush åˆ° GitHub å¾Œæ‰‹æ©Ÿå°±èƒ½çœ‹åˆ°
        const gitData = [
            { word: "æ—¥æœ¬èª", reading: "ã«ã»ã‚“ã”", meaning: "æ—¥æ–‡", category: "åè©", id: 1 },
            // åœ¨é€™è£¡ç¹¼çºŒæ–°å¢...
        ];

        let vocabs = [];

        // åˆå§‹åŒ–ç³»çµ±ï¼šåŠ å…¥éŒ¯èª¤åµæ¸¬
        try {
            const localData = JSON.parse(localStorage.getItem('myVocabsV3')) || [];
            vocabs = [...gitData, ...localData];
            console.log("ç³»çµ±åˆå§‹åŒ–æˆåŠŸï¼Œç›®å‰å–®å­—æ•¸:", vocabs.length);
        } catch (error) {
            console.error("è³‡æ–™è®€å–å¤±æ•—:", error);
            alert("è³‡æ–™è®€å–å¤±æ•—ï¼Œç³»çµ±å·²è‡ªå‹•ä¿®å¾©ã€‚");
            vocabs = [...gitData];
        }

        function addWord() {
            try {
                const w = document.getElementById('word').value.trim();
                const r = document.getElementById('reading').value.trim();
                const m = document.getElementById('meaning').value.trim();
                const c = document.getElementById('category').value;

                if (!w || !m) {
                    alert("âš ï¸ éŒ¯èª¤ï¼šå–®å­—å’Œæ„æ€ä¸èƒ½æ˜¯ç©ºçš„ï¼");
                    return;
                }

                const newVocab = { word: w, reading: r, meaning: m, category: c, id: Date.now() };
                
                // æ›´æ–°é™£åˆ—èˆ‡å„²å­˜
                const localOnly = JSON.parse(localStorage.getItem('myVocabsV3')) || [];
                localOnly.push(newVocab);
                localStorage.setItem('myVocabsV3', JSON.stringify(localOnly));
                
                vocabs.push(newVocab);
                renderList();
                updateQuizUI();

                // æ¸…é™¤è¼¸å…¥
                document.getElementById('word').value = '';
                document.getElementById('reading').value = '';
                document.getElementById('meaning').value = '';
                
                document.getElementById('status-bar').innerText = "â— Saved Success";
                document.getElementById('status-bar').classList.replace('text-green-500', 'text-indigo-500');
            } catch (e) {
                alert("âŒ æ–°å¢å¤±æ•—ï¼éŒ¯èª¤è¨Šæ¯ï¼š" + e.message);
                document.getElementById('status-bar').innerText = "â— Save Failed";
                document.getElementById('status-bar').classList.replace('text-green-500', 'text-red-500');
            }
        }

        function renderList() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const listEl = document.getElementById('vocab-list');
            const filtered = vocabs.filter(v => v.word.includes(search) || v.meaning.includes(search));
            
            listEl.innerHTML = filtered.map(v => `
                <li class="bg-white p-4 rounded-2xl flex justify-between items-center shadow-sm border border-gray-100">
                    <div>
                        <span class="text-[10px] font-black text-indigo-400 uppercase">${v.category}</span>
                        <div class="text-xl font-bold text-gray-800">${v.word} <span class="text-xs font-normal text-gray-400 ml-1">ã€${v.reading}ã€‘</span></div>
                        <div class="text-gray-500 text-sm font-medium">${v.meaning}</div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="speak('${v.word}')" class="w-10 h-10 flex items-center justify-center bg-gray-50 rounded-full text-gray-400">ğŸ”Š</button>
                        <button onclick="deleteWord(${v.id})" class="text-gray-300 hover:text-red-500 px-2">âœ•</button>
                    </div>
                </li>
            `).reverse().join('');
        }

        function deleteWord(id) {
            if (!confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) return;
            // éæ¿¾æ‰ Git å›ºå®šè³‡æ–™ï¼Œåªåˆªé™¤æœ¬åœ°è³‡æ–™
            let localData = JSON.parse(localStorage.getItem('myVocabsV3')) || [];
            localData = localData.filter(v => v.id !== id);
            localStorage.setItem('myVocabsV3', JSON.stringify(localData));
            
            vocabs = [...gitData, ...localData];
            renderList();
            updateQuizUI();
        }

        function speak(text) {
            window.speechSynthesis.cancel();
            const uttr = new SpeechSynthesisUtterance(text);
            const voices = window.speechSynthesis.getVoices();
            uttr.voice = voices.find(v => v.lang.includes('ja') && (v.name.includes('Google') || v.name.includes('Nanami'))) || voices.find(v => v.lang.includes('ja'));
            uttr.lang = 'ja-JP';
            uttr.rate = 0.8;
            uttr.pitch = 1.1;
            window.speechSynthesis.speak(uttr);
        }

        function updateQuizUI() {
            const section = document.getElementById('quiz-section');
            if (vocabs.length > 0) {
                section.classList.remove('hidden');
                if (!currentQuizWord) loadRandomWord();
            }
        }

        function loadRandomWord() {
            document.getElementById('quiz-card').classList.remove('is-flipped');
            if (vocabs.length === 0) return;
            setTimeout(() => {
                currentQuizWord = vocabs[Math.floor(Math.random() * vocabs.length)];
                document.getElementById('quiz-q').innerText = currentQuizWord.word;
                document.getElementById('quiz-r').innerText = currentQuizWord.reading;
                document.getElementById('quiz-a').innerText = currentQuizWord.meaning;
            }, 150);
        }

        function resetSystem() {
            if(confirm("é€™å°‡æ¸…é™¤æ‰‹æ©Ÿä¸Šçš„æ‰€æœ‰æš«å­˜å–®å­—ï¼Œç¢ºå®šå—ï¼Ÿ")) {
                localStorage.clear();
                location.reload();
            }
        }

        function exportCSV() {
            const header = "\uFEFFå–®å­—,è®€éŸ³,æ„æ€,åˆ†é¡\n";
            const rows = vocabs.map(v => `${v.word},${v.reading},${v.meaning},${v.category}`).join("\n");
            const blob = new Blob([header + rows], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "æ—¥æ–‡å–®å­—æœ¬.csv";
            link.click();
        }

        // å•Ÿå‹•
        renderList();
        updateQuizUI();
    </script>
</body>
</html>
